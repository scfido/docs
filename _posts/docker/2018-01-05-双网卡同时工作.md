---
   layout: default
   title: Windows Linux下双网卡同时工作设置方法
   tags: Docker Centos Windows
---

# {{ page.title }}
{{ page.date | date: "%Y-%m-%d" }}


首先你的机器需要有两块网卡，分别接到两台交换机上。

### Windows 设置方法

#### 外网网卡
- 地址：192.168.10.240
- 子网掩码：255.255.255.0
- 网关：192.168.10.1

#### 内网网卡
- 地址：192.168.2.3
- 子网掩码：255.255.255.0
- 网关：192.168.2.254
- DNS: 192.168.0.1

如果按正常的设置方法设置每块网卡的ip地址和网关，再cmd下使用`route print`查看时会看到
```
Network Destination Netmask Gateway Interface Metric
0.0.0.0 0.0.0.0 192.168.2.254 192.168.2.3 281    
0.0.0.0 0.0.0.0 192.168.10.1 192.168.10.240 35
...   
```
即指向`0.0.0.0`的有两个网关，这样就会出现路由冲突，两个网络都不能访问。  
如何实现同时访问两个网络？那要用到`route`命令。

第一步：删除所有0.0.0.0的路由
```
route delete 0.0.0.0
```
**注意**：如果是远程操作服务器这一步会断网，可以通过`&`将后续命令连续执行可以避免。
```
route delete 0.0.0.0 & route add 0.0.0.0 mask 0.0.0.0 192.168.10.1
```
    
第二步：添加0.0.0.0网络路由,这步的目的就是你可以上外网。
```
route add 0.0.0.0 mask 0.0.0.0 192.168.10.1
```

第三步：添加192.168.0.0网络路由，这时就可以同时访问两个网络了。注意是设置的`192.168.0.0`和`255.255.0.0`
```
route add 192.168.0.0 mask 255.255.0.0 192.168.2.254
```

但碰到一个问题，使用上述命令添加的路由在系统重新启动后会自动丢失，怎样保存现有的路由表呢？在route add 命令后加`-p`参数可以保持路由参数。

**注意**：内网的网卡网关会自动删除。

### Linux设置方法
这部分内容转载这篇文章以Centos 7为例

http://linux.it.net.cn/CentOS/fast/2015/1011/17930.html



1. 先来看一下图形界面中网卡配置的入口，在屏幕右上角点击网络图标
2. 本次实验环境有4块网卡，但只使用了其中的2块，他们是：enp7s0和enp2s0
3. enp7s0用来连接内网
4. enp2s0用来连接互联网

![](/assets/docker/双网卡同时工作/img/2018-01-05-17-14-27.png)

5. 接下来配置用来连接互联网的网卡，也就是enp2s0

![](/assets/docker/双网卡同时工作/img/2018-01-05-17-10-14.png)

6. 根据实际情况填写好    地址、网络掩码、网关、DNS等相关信息

![](/assets/docker/双网卡同时工作/img/2018-01-05-17-10-30.png)


7. 接下来配置连接内网的网卡，也就是enp7s0

![](/assets/docker/双网卡同时工作/img/2018-01-05-17-10-42.png)

8. 注意，此处只填写  地址、网络掩码  
而网关处填写 0.0.0.0，  
然后向下找到路由部分，根据实际情况填写好连接内网的路由  

![](/assets/docker/双网卡同时工作/img/2018-01-05-17-11-11.png)



 
9. 至此，双网卡实现，内、外网并存的设置就完成了，  
重启动网络就能看到效果。  
补充一下，如果你是字符界面只要按照下图的位置找到网卡配置文件进行编辑即可  

![](/assets/docker/双网卡同时工作/img/2018-01-05-17-11-57.png)

 
route文件如果没有就自己用touch命令建立一个然后再按照格式编辑其内容

![](/assets/docker/双网卡同时工作/img/2018-01-05-17-11-58.png)
